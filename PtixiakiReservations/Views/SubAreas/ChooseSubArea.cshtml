@model PtixiakiReservations.Models.Venue

@{
    ViewData["Title"] = "Choose Section";
    var eventId = ViewData["EventId"];
    var venueId = ViewData["VenueId"];
    var duration = ViewData["Duration"];
    var resDate = ViewData["ResDate"];
}

<div class="container mx-auto px-4 py-8 max-w-6xl">
    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <!-- Header with gradient background -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 py-6 px-8">
            <h1 class="text-3xl font-bold text-white">Choose a Section</h1>
            <p class="text-blue-100 mt-2">Select where you want to sit in @Model.Name</p>
        </div>

        <div class="p-6">
            <!-- Section list -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-4" id="subAreaContainer">
                <div class="col-span-full text-center py-12">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
                    <p class="mt-4 text-gray-600">Loading sections...</p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            const venueId = @venueId;
            const eventId = @eventId;
            const duration = "@duration";
            const resDate = "@resDate";

            // Load sub areas
            $.getJSON(`/SubAreas/GetSubAreas?venueId=${venueId}`, function (data) {
                // Clear loading indicator
                $("#subAreaContainer").empty();

                if (data && data.length > 0) {
                    // Render sub areas
                    data.forEach(function (subArea) {
                        const card = `
                            <div class="bg-blue-50 rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow">
                                <div class="p-5">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-2">${subArea.areaName}</h3>
                                    <p class="text-sm text-gray-600 mb-4">${subArea.desc || 'No description available'}</p>
                                    <a href="/Reservation/SelectSeats?eventId=${eventId}&subAreaId=${subArea.id}&duration=${duration}&resDate=${encodeURIComponent(resDate)}" 
                                       class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                                        Select Seats
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                        </svg>
                                    </a>
                                </div>
                            </div>
                        `;

                        $("#subAreaContainer").append(card);
                    });
                } else {
                    // No sub areas available
                    $("#subAreaContainer").html(`
                        <div class="col-span-full bg-gray-50 rounded-lg p-8 text-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                            <h3 class="mt-4 text-lg font-medium text-gray-900">No sections available</h3>
                            <p class="mt-2 text-gray-500">This venue doesn't have any defined sections yet.</p>
                            <a href="/Events/ReserveSeats?eventId=${eventId}" class="mt-4 inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                Go Back
                            </a>
                        </div>
                    `);
                }
            }).fail(function() {
                // Error loading sub areas
                $("#subAreaContainer").html(`
                    <div class="col-span-full bg-red-50 rounded-lg p-8 text-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 mx-auto text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <h3 class="mt-4 text-lg font-medium text-gray-900">Error Loading Sections</h3>
                        <p class="mt-2 text-gray-500">We couldn't load the sections for this venue. Please try again.</p>
                        <a href="/Events/ReserveSeats?eventId=${eventId}" class="mt-4 inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                            Go Back
                        </a>
                    </div>
                `);
            });
        });
    </script>
}